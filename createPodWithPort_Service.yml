
- hosts: controlVM
  tasks:
    - name: create resource using name generated by the server
      kubernetes.core.k8s:
        namespace: testing
        state: present
        generate_name: webserver
        definition:
          apiVersion: v1
          kind: Pod
          metadata:
            name: webserver
            labels:
              app: galaxy
              service: web
          spec:
            containers:
            - name: webserver
              image: nginx:latest
              ports:
              - containerPort: 8081

    - name: Create a Service object from an inline definition
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Service
          metadata:
            name: web
            namespace: testing
            labels:
              app: galaxy
              service: web
          spec:
            type: NodePort
            selector:
              app: galaxy
              service: web
            ports:
            - protocol: TCP
              targetPort: 80
              name: port-8081-tcp
              port: 80
              nodePort: 30007

# The POD is now accessible at 
curl http://10.xxx.xx.63:30007/